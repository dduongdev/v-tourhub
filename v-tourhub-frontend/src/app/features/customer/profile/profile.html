<div class="container pb-5">
    <div class="page-header text-start mb-5">
        <h1 class="page-title text-start mb-0">My Profile</h1>
        <p class="page-subtitle text-start m-0">Manage your personal information and preferences.</p>
    </div>

    @if (loading && !user) {
    <div class="d-flex justify-content-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
    } @else if (user) {
    <div class="row g-4">
        <!-- Sidebar: Avatar & Summary -->
        <div class="col-md-4">
            <div class="card-premium h-auto text-center p-4">
                <div class="position-relative d-inline-block mx-auto mb-3">
                    <img [src]="user.avatarUrl || 'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=random'"
                        class="rounded-circle shadow" alt="User Avatar"
                        style="width: 150px; height: 150px; object-fit: cover; border: 4px solid white;">
                    <label for="avatarUpload"
                        class="position-absolute bottom-0 end-0 btn btn-primary rounded-circle shadow-sm p-0 d-flex align-items-center justify-content-center hover-scale"
                        style="width: 40px; height: 40px; cursor: pointer;">
                        <i class="bi bi-camera-fill"></i>
                        <input type="file" id="avatarUpload" (change)="onFileSelected($event)" class="d-none"
                            accept="image/*">
                    </label>
                </div>
                <h4 class="mb-1 fw-bold text-dark">{{ user.firstName }} {{ user.lastName }}</h4>
                <p class="text-muted small mb-3">{{ user.email }}</p>
                <div class="d-grid mt-4">
                    <button class="btn btn-outline-danger rounded-pill">Log Out</button>
                </div>
            </div>
        </div>

        <!-- Main Content: Edit Form -->
        <div class="col-md-8">
            <div class="card-premium h-auto">
                <div class="card-header bg-transparent border-bottom p-4">
                    <h5 class="mb-0 fw-bold text-primary">Personal Details</h5>
                </div>
                <div class="card-body p-4">
                    <form (ngSubmit)="onSubmit()" #profileForm="ngForm">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label text-secondary fw-bold small">First
                                    Name</label>
                                <input type="text" class="form-control form-control-lg bg-light border-0" id="firstName"
                                    [(ngModel)]="user.firstName" name="firstName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label text-secondary fw-bold small">Last Name</label>
                                <input type="text" class="form-control form-control-lg bg-light border-0" id="lastName"
                                    [(ngModel)]="user.lastName" name="lastName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label text-secondary fw-bold small">Email</label>
                                <input type="email" class="form-control form-control-lg bg-light border-0" id="email"
                                    [value]="user.email" disabled readonly>
                                <div class="form-text text-muted">Email cannot be changed directly.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label text-secondary fw-bold small">Phone Number</label>
                                <input type="tel" class="form-control form-control-lg bg-light border-0" id="phone"
                                    [(ngModel)]="user.phone" name="phone">
                            </div>
                            <div class="col-12">
                                <label for="address" class="form-label text-secondary fw-bold small">Address</label>
                                <input type="text" class="form-control form-control-lg bg-light border-0" id="address"
                                    [(ngModel)]="user.address" name="address">
                            </div>
                            <div class="col-12">
                                <label for="bio" class="form-label text-secondary fw-bold small">Bio</label>
                                <textarea class="form-control form-control-lg bg-light border-0" id="bio" rows="3"
                                    [(ngModel)]="user.bio" name="bio"></textarea>
                            </div>
                            <!-- Currency preference could go here if supported by backend DTO -->

                            <div class="col-12 mt-4 text-end">
                                <button type="submit" class="btn btn-primary px-5 shadow-sm" [disabled]="loading">
                                    @if(loading) { <span class="spinner-border spinner-border-sm me-2"></span> }
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    }
</div>