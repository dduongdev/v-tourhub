<div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-5 page-header text-start">
        <div>
            <h1 class="page-title text-start mb-0">My Bookings</h1>
            <p class="page-subtitle text-start m-0">Manage your upcoming trips and history</p>
        </div>
        <button class="btn btn-outline-primary" (click)="loadBookings()"><i class="bi bi-arrow-clockwise"></i>
            Refresh</button>
    </div>

    @if (loading && bookings.length === 0) {
    <div class="d-flex justify-content-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
    } @else if (bookings.length === 0) {
    <div class="empty-state">
        <div class="empty-state-icon"><i class="bi bi-calendar-x"></i></div>
        <h3>No bookings found</h3>
        <p class="text-secondary">It looks like you haven't booked any trips yet.</p>
        <a routerLink="/explore" class="btn btn-primary mt-3">Explore Destinations</a>
    </div>
    } @else {
    <div class="grid-cards">
        @for (booking of bookings; track booking.bookingId) {
        <div class="card-premium">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <span class="badge-status" [class.bg-success-subtle]="booking.status === 'CONFIRMED'"
                        [class.text-success]="booking.status === 'CONFIRMED'"
                        [class.bg-warning-subtle]="booking.status === 'PENDING_PAYMENT'"
                        [class.text-warning]="booking.status === 'PENDING_PAYMENT'"
                        [class.bg-secondary-subtle]="booking.status === 'CANCELLED'"
                        [class.text-secondary]="booking.status === 'CANCELLED'">
                        {{ booking.status }}
                    </span>
                    <span class="small text-muted">#{{ booking.bookingId }}</span>
                </div>

                <h5 class="card-title fw-bold mb-1">
                    <a [routerLink]="['/service', booking.serviceId]"
                        class="text-decoration-none text-dark hover-primary">{{ booking.serviceName }}</a>
                </h5>
                <p class="text-primary fw-bold fs-4 mb-3">{{ booking.totalPrice | number }} VND</p>

                <!-- Countdown for Pending -->
                @if (booking.status === 'PENDING_PAYMENT' || booking.status === 'INITIATED') {
                <div class="alert alert-warning p-2 small mb-3 d-flex align-items-center gap-2">
                    <i class="bi bi-hourglass-split"></i>
                    Expires in: <app-countdown-timer [expiresAt]="booking.expiresAt" />
                </div>
                }

                <hr class="border-secondary opacity-10 my-3">

                <div class="d-grid gap-2">
                    @if (booking.status === 'PENDING_PAYMENT') {
                    <button (click)="pay(booking.bookingId)" class="btn btn-primary w-100">
                        Pay Now <i class="bi bi-credit-card ms-2"></i>
                    </button>
                    }
                    <a [routerLink]="['/service', booking.serviceId]" class="btn btn-outline-primary w-100">View
                        Details</a>
                </div>
            </div>
        </div>
        }
    </div>
    }
</div>